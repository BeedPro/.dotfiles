#!/bin/bash

REPO_URL="https://github.com/mwh/dragon"
BUILD_DIR="/tmp/dragon-build"
INSTALL_PREFIX="$HOME/.local"

echo "Step 1: Installing dependencies..."
sudo apt update
sudo apt install -y build-essential libgtk-3-dev pkg-config git

rm -rf "$BUILD_DIR"

echo "Step 2: Cloning repository..."
git clone "$REPO_URL" "$BUILD_DIR"
cd "$BUILD_DIR" || exit

echo "Step 3: Compiling dragon..."
make

echo "Step 4: Installing to $INSTALL_PREFIX/bin..."
mkdir -p "$INSTALL_PREFIX/bin"

make PREFIX="$INSTALL_PREFIX" install

echo "Step 5: Cleaning up..."
rm -rf "$BUILD_DIR"

if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    echo "--------------------------------------------------------"
    echo "NOTE: $HOME/.local/bin is not in your PATH."
    echo "You may need to add 'export PATH=\$HOME/.local/bin:\$PATH' to your .zshrc"
    echo "--------------------------------------------------------"
fi

echo "Installation complete! You can now run 'dragon'."
