#!/usr/bin/env bash
SINK="@DEFAULT_SINK@"

case "$1" in
	up)
		pactl set-sink-mute "$SINK" 0
		pactl set-sink-volume "$SINK" +5%
		;;
	down)
		pactl set-sink-mute "$SINK" 0
		pactl set-sink-volume "$SINK" -5%
		;;
	mute)
		pactl set-sink-mute "$SINK" toggle
		;;
esac

# Try to get info, else fallback
info=$(pactl get-sink-volume "$SINK" 2>/dev/null)
mute=$(pactl get-sink-mute "$SINK" 2>/dev/null)

TITLE="Volume"
BODY="vol --%"

# If pactl failed
if [ -n "$info" ] && [ -n "$mute" ]; then
	vol=$(echo "$info" | grep -oP '\d+%' | head -1 | tr -d '%')

	BAR_WIDTH=45
	FILLED=$((vol * BAR_WIDTH / 100))
	EMPTY=$((BAR_WIDTH - FILLED))

	if echo "$mute" | grep -q yes; then
		# muted: greyed bar
    TITLE="$TITLE MUTED"
		BAR="$(printf '%0.s#' $(seq 1 $FILLED))$(printf '%0.s-' $(seq 1 $EMPTY))"
		BODY="[${BAR}]"
	else
    TITLE="$TITLE ${vol}%"
		BAR="$(printf '%0.s|' $(seq 1 $FILLED))$(printf '%0.s-' $(seq 1 $EMPTY))"
		BODY="[${BAR}]"
	fi
fi

notify-send -r 9999 -t 1000 "$TITLE" "\n$BODY"
